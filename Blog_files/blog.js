define(["designer/util/util.instances","designer/util/util.model","jquery","designer/util/blogUrlHelper","wsbcore/share","wsbcore/overlay"],function(e,t,a,r){function l(e,a){this.$element=e,this.model=new t(a),this.mode=this.model.get("mode"),this.i18N=this.model.get("i18N"),this.init()}function o(e){var t=/<img[^>]+>/i,r=a('<a href="'+e.link+'" target="_blank" class="wsb-blog-vert-image">'),l=t.exec(e.content);return l&&r.append(l[0]),r}function s(e){var t=/<img[^>]+>/i,r=a('<a href="'+e.link+'" target="_blank" class="wsb-blog-horz-image">'),l=t.exec(e.content);return l?(r.append(l[0]),r):null}function i(e){return e=e.replace(/http[s]?:\/\//,"http://").toLowerCase(),"http://"+e.match(/:\/\/(.[^/]+)/)[1]}var n,g,d="wsb-blog",c="ui-blog",p=!1,h=!1,b=[];window.googleAPILoaded=function(){for(p=!0,h=!1;b.length>0;){var e=b.shift();google.load("feeds","1",{callback:e})}},l.prototype={init:function(){this.refresh()},initializeGoogleFeeds:function(e){p||"object"==typeof google&&"object"==typeof google.feeds?(p=!0,e()):h?b.push(e):(b.push(e),h=!0,require(["//www.google.com/jsapi?sensor=false&key=AIzaSyAsaQtr02Mt5fQigviYgmIy37VP-hcO9TU&callback=googleAPILoaded"]))},refresh:function(){var e=[];g=this.$element,g.empty();var t,l=this.model.get("BlogPageLayoutId"),o=this,s=o.model.get("ID");g.addClass(c),"designer"==this.mode&&(this.$overlay&&this.$overlay.length||(this.$overlay=a("<div/>").addClass(d+"-overlay")),this.$overlay.css({filter:"alpha(opacity = 0)"}).children().remove(),this.$overlay.appendTo(this.$element)),g.find("#"+s+" .blogContainer").length?(t=a("#"+s+" .blogContainer"),t.empty()):(t=a('<div class="wsb-blog-container blogContainer" style="height: '+o.model.get("Height")+'">'),g.append(t)),t.sfMsgOverlay({message:o.i18N.resources.Loading});var i=function(){var a=r.getCustomUrl(o.model.get("BlogUrl")),s=a.url;n=a.blogType;var i=new google.feeds.Feed(s),g=o.model.get("BlogListingsPerPage"),d=o.model.get("ShowBlogImages"),c=o.model.get("ShowBlogCategories");i.setNumEntries(g),i.includeHistoricalEntries(),i.load(function(a){var r=a.error?"":a.feed.entries;if(t.sfMsgOverlay({message:null}),""==r)t.append("<div id='nofeeds'>"+o.i18N.resources.Client__No_entries_to_display+"</div>");else{for(var s=0;s<r.length;s++)e[s]=r[s];o.renderFeedEntries(e,l,d,c,t)}})};this.initializeGoogleFeeds(i)},destroy:function(){f.destroy(this.$element),this.$element.remove()},renderFeedEntries:function(e,t,r,l,g){var d,c=this;if(1==t)for(var p=0;p<e.length;p++){var h=a('<div class="wsb-blog-text-vert-wrap">');if(1==r)var b=o(e[p]);if(h.append('<div class="wsb-blog-post-header"><a href="'+e[p].link+'" target="_blank">'+e[p].title+"</a></div>"),e[p].publishedDate&&(d=new Date(e[p].publishedDate),h.append('<p id="wsb-blog-publish-date">'+d.toLocaleString()+"</p>")),1==l)for(var f=0;f<e[p].categories.length;f++)switch(n){case"tumblr":h.append((f>0?", ":"")+'<a class="wsb-blog-category" href="'+i(c.model.get("BlogUrl"))+"/tagged/"+e[p].categories[f]+'" target="_blank">'+e[p].categories[f]+"</a>");break;case"blogger":h.append((f>0?", ":"")+'<a class="wsb-blog-category" href="'+i(c.model.get("BlogUrl"))+"/search/label/"+e[p].categories[f]+'" target="_blank">'+e[p].categories[f]+"</a>")}h.append('<div class="wsb-blog-entry-text"><a href="'+e[p].link+'" target="_blank">'+e[p].contentSnippet+"</a></div>"),a('<div class="wsb-blog-vert-entry-wrap"></div>').append(b).append(h).appendTo(g)}else{var v=a("<ul class='wsb-blog-horz-wrap'>");g.append(v);for(var u=0;u<e.length;u++){var m=a("<li>");if(v.append(m),1==r){var w=s(e[u]);w&&m.append(w)}else m.css({height:"250px"});if(m.append('<h3 class="wsb-blog-post-header"><a href="'+e[u].link+'" target="_blank">'+e[u].title+"</a></div>"),e[u].publishedDate&&(d=new Date(e[u].publishedDate),m.append('<p id="wsb-blog-publish-date">'+d.toLocaleString()+"</p>")),1==l)for(var y=0;y<e[u].categories.length;y++)switch(n){case"tumblr":m.append((y>0?", ":"")+'<a class="wsb-blog-category" href="'+i(c.model.get("BlogUrl"))+"/tagged/"+e[u].categories[y]+'" target="_blank">'+e[u].categories[y]+"</a>");break;case"blogger":m.append((y>0?", ":"")+'<a class="wsb-blog-category" href="'+i(c.model.get("BlogUrl"))+"/search/label/"+e[u].categories[y]+'" target="_blank">'+e[u].categories[y]+"</a>")}m.append('<div class="wsb-blog-entry-text"><a href="'+e[u].link+'" target=_blank >'+e[u].contentSnippet+"</a></div>")}}}};var f=new e(d,l);return{render:function(e,t){var a=f.get(e);return a?a.refresh():a=f.create(e,t),a},destroy:function(e){var t=f.get(e);return t?(f.destroy(e),!0):!1}}});
//# sourceMappingURL=blog.js.map